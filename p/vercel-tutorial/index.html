<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="价格和限制 总结 分类（原始名称） 业余爱好者计划（Hobby） 专业计划（Pro） 项目数（Projects） 200 无限制 每天创建的部署数（Deploy"><title>Vercel Tutorial</title>
<link rel=canonical href=https://blog.ververv.com/p/vercel-tutorial/><link rel=stylesheet href=/scss/style.min.d8118f156935b64eca93aca758476adca858d2c47354971654d9bd2933a0e45f.css><meta property='og:title' content="Vercel Tutorial"><meta property='og:description' content="价格和限制 总结 分类（原始名称） 业余爱好者计划（Hobby） 专业计划（Pro） 项目数（Projects） 200 无限制 每天创建的部署数（Deploy"><meta property='og:url' content='https://blog.ververv.com/p/vercel-tutorial/'><meta property='og:site_name' content='量子跳跃者'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2023-12-16T13:32:59+08:00'><meta property='article:modified_time' content='2023-12-16T13:32:59+08:00'><meta name=twitter:title content="Vercel Tutorial"><meta name=twitter:description content="价格和限制 总结 分类（原始名称） 业余爱好者计划（Hobby） 专业计划（Pro） 项目数（Projects） 200 无限制 每天创建的部署数（Deploy"><link rel="shortcut icon" href=/favicon.png><script defer src=https://analytics.ververv.com/pixel/tABAb34VvSTV05V2></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>量子跳跃者</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/ target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#总结>总结</a></li><li><a href=#一般限制>一般限制</a></li><li><a href=#heading></a></li><li><a href=#流量>流量</a></li><li><a href=#日志>日志</a></li><li><a href=#团队>团队</a></li></ol><ol><li><a href=#编译>编译</a><ol><li><a href=#root-directory>Root Directory</a></li></ol></li><li><a href=#部署>部署</a><ol><li><a href=#预览>预览</a></li></ol></li></ol><ol><li><a href=#edge-network>Edge Network</a><ol><li><a href=#regions>Regions</a></li></ol></li><li><a href=#serverless-functions>Serverless Functions</a><ol><li><a href=#查看日志>查看日志</a></li><li><a href=#占用的硬件资源>占用的硬件资源</a></li><li><a href=#内存>内存</a></li></ol></li><li><a href=#edge-functions>Edge Functions</a><ol><li><a href=#quick-start>Quick Start</a></li></ol></li><li><a href=#edge-middleware>Edge Middleware</a><ol><li><a href=#创建edge-middleware>创建Edge Middleware</a></li></ol></li><li><a href=#image-optimization>Image Optimization</a></li><li><a href=#incremental-static-regeneration>Incremental Static Regeneration</a><ol><li><a href=#quick-start-1>Quick Start</a></li></ol></li><li><a href=#edge-cache>Edge Cache</a></li><li><a href=#data-cache>Data Cache</a><ol><li><a href=#vercel-edge-cache边缘缓存>Vercel Edge Cache（边缘缓存）</a></li><li><a href=#vercel-data-cache数据缓存>Vercel Data Cache（数据缓存）</a></li><li><a href=#对比>对比</a></li></ol></li><li><a href=#cron-jobs>Cron Jobs</a><ol><li><a href=#quick-start-2>Quick Start</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/vercel-tutorial/>Vercel Tutorial</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Dec 16, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 6 分钟</time></div></footer></div></header><section class=article-content><h1 id=价格和限制>价格和限制</h1><h2 id=总结>总结</h2><div class=table-wrapper><table><thead><tr><th>分类（原始名称）</th><th>业余爱好者计划（Hobby）</th><th>专业计划（Pro）</th></tr></thead><tbody><tr><td>项目数（Projects）</td><td>200</td><td>无限制</td></tr><tr><td>每天创建的部署数（Deployments Created per Day）</td><td>100</td><td>6000</td></tr><tr><td>每次部署创建的无服务器功能数（Serverless Functions Created per Deployment）</td><td>取决于框架*</td><td>无限制</td></tr><tr><td>每周从CLI创建的部署数（Deployments Created from CLI per Week）</td><td>2000</td><td>2000</td></tr><tr><td>每个团队的团队成员数（Team Members per Team）</td><td>-</td><td>10</td></tr><tr><td>每个Git仓库连接的Vercel项目数（Vercel Projects Connected per Git Repository）</td><td>3</td><td>60</td></tr><tr><td>每次部署创建的路由数（Routes created per Deployment）</td><td>1024</td><td>1024</td></tr><tr><td>每次部署的构建时间（Build Time per Deployment）</td><td>45分钟</td><td>45分钟</td></tr><tr><td>并行构建数（Concurrent Builds）</td><td>1</td><td>12</td></tr><tr><td>磁盘大小（Disk Size）</td><td>13 GB</td><td>13 GB</td></tr><tr><td>Cron作业（Cron Jobs）</td><td>2*</td><td>40</td></tr><tr><td>包含的使用量</td><td></td><td></td></tr><tr><td>带宽（Bandwidth）</td><td>100 GB</td><td>1 TB</td></tr><tr><td>无服务器功能执行（Serverless Function Execution）</td><td>100 GB-Hrs</td><td>1000 GB-Hrs</td></tr><tr><td>边缘功能执行单位（Edge Function Execution Units）</td><td>500,000</td><td>1,000,000</td></tr><tr><td>边缘中间件调用（Edge Middleware Invocations）</td><td>1,000,000</td><td>1,000,000</td></tr><tr><td>构建执行（Build Execution）</td><td>100 Hrs</td><td>400 Hrs</td></tr><tr><td>图像优化源图像（Image Optimization Source Images）</td><td>1000图像</td><td>5000图像</td></tr><tr><td>远程缓存下载（Remote Cache downloads）</td><td>10GB</td><td>10GB</td></tr><tr><td>远程缓存上传（Remote Cache uploads）</td><td>100GB</td><td>1TB</td></tr></tbody></table></div><h2 id=一般限制>一般限制</h2><div class=table-wrapper><table><thead><tr><th style=text-align:left></th><th style=text-align:left>Hobby</th><th></th><th style=text-align:left>Pro</th><th style=text-align:left>Enterprise</th></tr></thead><tbody><tr><td style=text-align:left>Projects</td><td style=text-align:left>200</td><td>短期内不会超</td><td style=text-align:left>Unlimited</td><td style=text-align:left>Unlimited</td></tr><tr><td style=text-align:left>Deployments Created per Day</td><td style=text-align:left>100</td><td>短期内不会超</td><td style=text-align:left>6000</td><td style=text-align:left>Custom</td></tr><tr><td style=text-align:left>Serverless Functions Created per Deployment</td><td style=text-align:left><a class=link href=https://vercel.com/docs/functions/serverless-functions/runtimes#functions-created-per-deployment target=_blank rel=noopener>Framework-dependent*</a></td><td></td><td style=text-align:left>∞</td><td style=text-align:left>∞</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/limits/overview#proxied-request-timeout target=_blank rel=noopener>Proxied Request Timeout </a>(Seconds)</td><td style=text-align:left>30</td><td></td><td style=text-align:left>30</td><td style=text-align:left>30</td></tr><tr><td style=text-align:left>Deployments Created from CLI per Week</td><td style=text-align:left>2000</td><td>一样</td><td style=text-align:left>2000</td><td style=text-align:left>Custom</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/accounts/team-members-and-roles target=_blank rel=noopener>Team Members</a> per Team</td><td style=text-align:left>-</td><td>一样</td><td style=text-align:left>10</td><td style=text-align:left>Custom</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/limits/overview#connecting-a-project-to-a-git-repository target=_blank rel=noopener>Vercel Projects Connected per Git Repository</a></td><td style=text-align:left>3</td><td></td><td style=text-align:left>60</td><td style=text-align:left>Custom</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/limits/overview#routes-created-per-deployment target=_blank rel=noopener>Routes created per Deployment</a></td><td style=text-align:left>1024</td><td>一样</td><td style=text-align:left>1024</td><td style=text-align:left>Custom</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/limits/overview#build-time-per-deployment target=_blank rel=noopener>Build Time per Deployment</a>(Minutes)</td><td style=text-align:left>45</td><td>一样</td><td style=text-align:left>45</td><td style=text-align:left>45</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/deployments/concurrent-builds target=_blank rel=noopener>Concurrent Builds</a></td><td style=text-align:left>1</td><td>这个可能影响</td><td style=text-align:left>12</td><td style=text-align:left>Custom</td></tr><tr><td style=text-align:left>Disk Size (GB)</td><td style=text-align:left>13</td><td></td><td style=text-align:left>13</td><td style=text-align:left>13</td></tr><tr><td style=text-align:left>Cron Jobs</td><td style=text-align:left><a class=link href=https://vercel.com/docs/cron-jobs/usage-and-pricing target=_blank rel=noopener>2*</a></td><td>这个可能影响</td><td style=text-align:left>40</td><td style=text-align:left>100</td></tr></tbody></table></div><h2 id=heading></h2><h2 id=流量>流量</h2><div class=table-wrapper><table><thead><tr><th style=text-align:left></th><th style=text-align:left>Hobby</th><th></th><th style=text-align:left>Pro</th></tr></thead><tbody><tr><td style=text-align:left>Bandwidth</td><td style=text-align:left>100 GB</td><td>流量比较少</td><td style=text-align:left>1 TB</td></tr><tr><td style=text-align:left>Serverless Function Execution</td><td style=text-align:left>100 GB-Hrs</td><td>10倍差距</td><td style=text-align:left>1000 GB-Hrs</td></tr><tr><td style=text-align:left>Edge Function Execution Units</td><td style=text-align:left>500,000</td><td>2倍差距</td><td style=text-align:left>1,000,000</td></tr><tr><td style=text-align:left>Edge Middleware Invocations</td><td style=text-align:left>1,000,000</td><td>一样</td><td style=text-align:left>1,000,000</td></tr><tr><td style=text-align:left>Build Execution</td><td style=text-align:left>100 Hrs</td><td>4倍</td><td style=text-align:left>400 Hrs</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/image-optimization#source-images target=_blank rel=noopener>Image Optimization Source Images</a></td><td style=text-align:left>1000 Images</td><td>5倍</td><td style=text-align:left>5000 Images</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/monorepos/remote-caching target=_blank rel=noopener>Remote Cache downloads</a></td><td style=text-align:left>10GB</td><td>一样</td><td style=text-align:left>10GB</td></tr><tr><td style=text-align:left><a class=link href=https://vercel.com/docs/monorepos/remote-caching target=_blank rel=noopener>Remote Cache uploads</a></td><td style=text-align:left>100GB</td><td>10倍</td><td style=text-align:left>1TB</td></tr></tbody></table></div><h2 id=日志>日志</h2><p>每个日志4K。</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>Plan</th><th style=text-align:left>Retention time</th><th style=text-align:left>Log entries</th></tr></thead><tbody><tr><td style=text-align:left>Hobby</td><td style=text-align:left>1 hour of logs：只保留一个小时</td><td style=text-align:left>Up to 4000 rows of log data</td></tr><tr><td style=text-align:left>Pro</td><td style=text-align:left>1 day of logs</td><td style=text-align:left>Up to 100,000 rows of log data</td></tr><tr><td style=text-align:left>Enterprise</td><td style=text-align:left>3 days of logs</td><td style=text-align:left>Up to 60 million rows of log data</td></tr></tbody></table></div><h2 id=团队>团队</h2><p>Hobby只能创建个人项目。</p><p>如果要创建团队，只能切换到Pro计划。</p><img src=https://cdn.jsdelivr.net/gh/haibinyang/img@main/picgo/image-20240108230735752.png alt=image-20240108230735752 style=zoom:33%><p>Vercel does not support connecting your Personal Account&rsquo;s Projects to Git repositories owned by Git organizations.</p><h1 id=基础>基础</h1><h2 id=编译>编译</h2><p>Build and Development Settings</p><p><img src=https://cdn.jsdelivr.net/gh/haibinyang/img@main/picgo/image-20240109172817859.png loading=lazy alt=image-20240109172817859></p><h3 id=root-directory>Root Directory</h3><p>For example, your repository might have a <code>front-end</code> directory containing a stand-alone <a class=link href=https://nextjs.org/ target=_blank rel=noopener>Next.js</a> app.</p><p><a class=link href=https://vercel.com/docs/deployments/configure-a-build target=_blank rel=noopener>参考</a></p><h2 id=部署>部署</h2><h3 id=预览>预览</h3><p>没有触发成功</p><p><a class=link href=https://vercel.com/docs/deployments/preview-deployments target=_blank rel=noopener>教程</a></p><h1 id=基础设施>基础设施</h1><h1 id=vercel基础设施架构>Vercel基础设施架构</h1><p><img src="https://vercel.com/_next/image?url=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Fv1689795055%2Fdocs-assets%2Fstatic%2Fdocs%2Fconcepts%2Ffunctions%2Fedge-functions-light.png&amp;w=3840&amp;q=75&amp;dpl=dpl_AX4JTQxAUw2CkmFmkXL8unHs8AzT" loading=lazy alt=img></p><h2 id=edge-network>Edge Network</h2><h3 id=regions>Regions</h3><div class=table-wrapper><table><thead><tr><th>Region Code</th><th>Region Name</th><th>Reference Location</th></tr></thead><tbody><tr><td>cle1</td><td>us-east-2</td><td>Cleveland, USA</td></tr><tr><td>hkg1</td><td>ap-east-1</td><td>Hong Kong</td></tr><tr><td>hnd1</td><td>ap-northeast-1</td><td>Tokyo, Japan</td></tr><tr><td>iad1(最重要)</td><td>us-east-1</td><td>Washington, D.C., USA</td></tr><tr><td>sfo1</td><td>us-west-1</td><td>San Francisco, USA</td></tr><tr><td>sin1</td><td>ap-southeast-1</td><td>Singapore</td></tr></tbody></table></div><h2 id=serverless-functions>Serverless Functions</h2><p>默认情况下，Serverless Functions 在美国华盛顿特区 （ <code>iad1</code> ） 执行。</p><h3 id=查看日志>查看日志</h3><img src=https://cdn.jsdelivr.net/gh/haibinyang/img@main/picgo/image-20240108234351555.png alt=image-20240108234351555 style=zoom:25%>
<img src=https://cdn.jsdelivr.net/gh/haibinyang/img@main/picgo/image-20240108234526225.png alt=image-20240108234526225 style=zoom:33%><h3 id=占用的硬件资源>占用的硬件资源</h3><p>如果配置了 1,769 MB 内存，则无服务器函数将具有相当于一个 vCPU 的内存。</p><h3 id=内存>内存</h3><ul><li>Hobby：最大1G内存</li><li>Pro：最大3G内存</li></ul><p>调整内存大小 ：</p><blockquote><p>vercel.json</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;functions&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;api/test.js&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory&#34;</span><span class=p>:</span> <span class=mi>3008</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;api/*.js&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;memory&#34;</span><span class=p>:</span> <span class=mi>3008</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;maxDuration&#34;</span><span class=p>:</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=edge-functions>Edge Functions</h2><h3 id=quick-start>Quick Start</h3><ol><li>创建next.js项目</li><li>创建API接口</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// app/api/edge/route.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>NextResponse</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;next/server&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=kr>type</span> <span class=p>{</span> <span class=nx>NextRequest</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;next/server&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>const</span> <span class=nx>runtime</span> <span class=o>=</span> <span class=s1>&#39;edge&#39;</span><span class=p>;</span> <span class=c1>// 关键点，默认是node.js
</span></span></span><span class=line><span class=cl><span class=c1></span> 
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kd>function</span> <span class=nx>GET</span><span class=p>(</span><span class=nx>request</span>: <span class=kt>NextRequest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>NextResponse</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>body</span>: <span class=kt>request.body</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>query</span>: <span class=kt>request.nextUrl.search</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>cookies</span>: <span class=kt>request.cookies.getAll</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>status</span>: <span class=kt>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在浏览器访问</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>https://vercel-edge-function-two.vercel.app/api/edge?key<span class=o>=</span><span class=m>123</span>
</span></span></code></pre></td></tr></table></div></div><p>响应</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;body&#34;</span><span class=p>:</span><span class=kc>null</span><span class=p>,</span><span class=nt>&#34;query&#34;</span><span class=p>:</span><span class=s2>&#34;?key=123&#34;</span><span class=p>,</span><span class=nt>&#34;cookies&#34;</span><span class=p>:[]}</span>
</span></span></code></pre></td></tr></table></div></div><p>查看日志</p><p><img src=https://cdn.jsdelivr.net/gh/haibinyang/img@main/picgo/image-20240109085934289.png loading=lazy alt=image-20240109085934289></p><p><a class=link href=https://vercel.com/docs/functions/edge-functions/quickstart target=_blank rel=noopener>教程</a></p><p><a class=link href=https://github.com/yhb-tutorial/vercel-edge-function target=_blank rel=noopener>源码</a></p><h2 id=edge-middleware>Edge Middleware</h2><p>位置</p><p>处理请求之前执行的代码</p><p>本质</p><p>运行在Edge Runtime，本质上与Edge Functions一样。</p><p><img src="https://vercel.com/_next/image?url=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Fv1689795055%2Fdocs-assets%2Fstatic%2Fdocs%2Fconcepts%2Ffunctions%2Fedge-middleware-light.png&amp;w=3840&amp;q=75&amp;dpl=dpl_2umL2AnS38YL619aBdkbfBU7b3WX" loading=lazy alt="Edge Middleware location within Vercel infrastructure."></p><p>作用</p><p>返回响应之前执行自定义逻辑、重写、重定向、添加标头等。</p><h3 id=创建edge-middleware>创建Edge Middleware</h3><p>创建Next.js项目</p><p>创建 <code>middleware.ts</code> ，放在与 <code>app</code> 目录处于同一级。</p><h2 id=image-optimization>Image Optimization</h2><p>N/A</p><h2 id=incremental-static-regeneration>Incremental Static Regeneration</h2><ol><li><strong>传统静态网站生成的限制</strong>：<ul><li>传统的SSG在构建时会生成网站的所有页面，这对于大型网站来说可能非常耗时。</li><li>每次内容更新都需要重新构建整个站点，这可能导致长时间的部署和潜在的服务中断。</li></ul></li><li><strong>ISR的工作原理</strong>：<ul><li>使用ISR时，你只需在构建时生成一部分页面。</li><li>当用户访问尚未生成的页面时，Vercel会在后台生成这些页面，并将它们作为静态内容提供给用户。</li><li>一旦页面被生成，它就会被缓存并用于后续的请求，直到下一次预定的再生（regeneration）。</li></ul></li><li><strong>再生策略</strong>：<ul><li>你可以设置一个时间间隔，告诉Vercel多久重新生成页面。这意味着内容可以定期更新，而不需要手动触发整个站点的重新构建。</li><li>这种策略非常适合内容经常变化的网站，如新闻网站或博客。</li></ul></li><li><strong>好处</strong>：<ul><li><strong>性能优化</strong>：ISR可以显著提高大型网站的构建速度。<ul><li><strong>实时内容更新</strong>：网站内容可以更频繁且自动地更新，而无需完整的站点重建。</li></ul></li><li><strong>缩短部署时间</strong>：只需生成一部分页面，减少了部署的时间和资源消耗。</li></ul></li></ol><h3 id=quick-start-1>Quick Start</h3><blockquote><p>app/blog-posts/page.tsx</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>interface</span> <span class=nx>Post</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>title</span>: <span class=kt>string</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>id</span>: <span class=kt>number</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>Page() {</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>fetch</span><span class=p>(</span><span class=s1>&#39;https://api.vercel.app/blog&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>next</span><span class=o>:</span> <span class=p>{</span> <span class=nx>revalidate</span>: <span class=kt>10</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>posts</span> <span class=o>=</span> <span class=p>(</span><span class=k>await</span> <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>())</span> <span class=kr>as</span> <span class=nx>Post</span><span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=nx>posts</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>post</span>: <span class=kt>Post</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=p>&lt;</span><span class=nt>li</span> <span class=na>key</span><span class=o>=</span><span class=p>{</span><span class=nx>post</span><span class=p>.</span><span class=nx>id</span><span class=p>}&gt;{</span><span class=nx>post</span><span class=p>.</span><span class=nx>title</span><span class=p>}&lt;/</span><span class=nt>li</span><span class=p>&gt;;</span>
</span></span><span class=line><span class=cl>            <span class=p>})}</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;/</span><span class=nt>ul</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><a class=link href=https://vercel.com/docs/incremental-static-regeneration target=_blank rel=noopener>参考</a></p><h2 id=edge-cache>Edge Cache</h2><p>原理：通过HTTP头部来控制客户端和CDN服务器的缓存行为。</p><blockquote><p>HTTP标准的Cache-Control见<a class=link href=https://blog.ververv.com/p/http/#Header target=_blank rel=noopener>这里</a></p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// app/api/cache-control-headers/route.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>GET() {</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nx>Response</span><span class=p>(</span><span class=s1>&#39;Cache Control example&#39;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>status</span>: <span class=kt>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>headers</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=s1>&#39;Cache-Control&#39;</span><span class=o>:</span> <span class=s1>&#39;max-age=10&#39;</span><span class=p>,</span> <span class=c1>// 浏览器只缓存10秒
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=s1>&#39;CDN-Cache-Control&#39;</span><span class=o>:</span> <span class=s1>&#39;max-age=30&#39;</span><span class=p>,</span> <span class=c1>// 中间的CDN厂商只缓存60秒
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=s1>&#39;Vercel-CDN-Cache-Control&#39;</span><span class=o>:</span> <span class=s1>&#39;max-age=30&#39;</span><span class=p>,</span> <span class=c1>// Vercel的CDN服务器缓存1小时
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在Log中，真正执行/api/cache-control-headers的两次间隔是30秒，说明在Vercel CDN Network中返回了缓存数据。</p><p><img src=https://cdn.jsdelivr.net/gh/haibinyang/img@main/picgo/image-20240109162849732.png loading=lazy alt=image-20240109162849732></p><p><strong>默认的配置</strong></p><p><code>cache-control: public, max-age=0, must-revalidate</code></p><p>边缘网络和浏览器不缓存。</p><p><strong>建议的配置</strong></p><p><code>max-age=0, s-maxage=86400</code></p><p>此配置告诉浏览器不要缓存，允许 Vercel 的边缘网络缓存响应并在部署更新时使它们失效。</p><p><a class=link href=https://vercel.com/docs/edge-network/headers#cache-control-header target=_blank rel=noopener>Vercel的Cache-Control的定义</a></p><p><a class=link href=https://developers.cloudflare.com/cache/concepts/cdn-cache-control/ target=_blank rel=noopener>CloudFlare也有类似的Header</a></p><h2 id=data-cache>Data Cache</h2><p>还是不明白。</p><p>Vercel提供了两种类型的缓存：Edge Cache（边缘缓存）和Data Cache（数据缓存）。这两者都是为了提高网站性能和响应速度，但它们在应用和工作方式上有所不同。</p><h3 id=vercel-edge-cache边缘缓存>Vercel Edge Cache（边缘缓存）</h3><ul><li><strong>目的</strong>：主要用于缓存整个静态资产，如图片、字体和JavaScript捆绑包。</li><li><strong>工作方式</strong>：Edge Cache存储在Vercel的边缘网络上，当用户请求静态内容时，它可以从最近的边缘位置提供这些内容，从而减少延迟。</li><li><strong>应用场景</strong>：适用于任何静态资源，比如网站上的图片或CSS文件。</li><li><strong>特点</strong>：由于内容是静态的，因此在更新时可能需要手动刷新缓存。</li></ul><h3 id=vercel-data-cache数据缓存>Vercel Data Cache（数据缓存）</h3><ul><li><strong>目的</strong>：专门用于存储来自如Next.js等前端框架的数据提取响应。</li><li><strong>工作方式</strong>：Data Cache支持每次提取而不是每个路由的缓存，这意味着在同一路由中可以同时拥有静态、动态和重新验证的数据。</li><li><strong>应用场景</strong>：适用于需要动态生成的内容，如API响应或数据库查询结果。</li><li><strong>特点</strong>：提供时间基的重新验证、按需重新验证和基于标签的重新验证。缓存是全局的，但在每个地区独立运作。</li></ul><h3 id=对比>对比</h3><ul><li><strong>数据动态性</strong>：Edge Cache更适合完全静态的内容，而Data Cache则适用于动态内容或混合内容。</li><li><strong>更新机制</strong>：Data Cache提供更灵活的更新机制，包括基于时间和标签的重新验证，适合内容经常变化的场景。</li></ul><p>总的来说，Edge Cache适用于那些不常变更且对性能要求高的静态资源，而Data Cache则更适合需要频繁更新或个性化的动态数据。在实际应用中，两者可以结合使用，以优化整体网站性能和用户体验。</p><p><a class=link href=https://vercel.com/docs/infrastructure/data-cache target=_blank rel=noopener>参考</a></p><h2 id=cron-jobs>Cron Jobs</h2><h3 id=quick-start-2>Quick Start</h3><p>配置vercel.json文件执行哪个函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;crons&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;path&#34;</span><span class=p>:</span> <span class=s2>&#34;/api/cron&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;schedule&#34;</span><span class=p>:</span> <span class=s2>&#34;0 5 * * *&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>创建函数</p><blockquote><p>app/api/cron/route.ts</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-tsx data-lang=tsx><span class=line><span class=cl><span class=kr>export</span> <span class=kr>async</span> <span class=kd>function</span> <span class=nx>GET() {</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>result</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>fetch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;http://worldtimeapi.org/api/timezone/America/Chicago&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>cache</span><span class=o>:</span> <span class=s1>&#39;no-store&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>result</span><span class=p>.</span><span class=nx>json</span><span class=p>();</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>Response</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span> <span class=nx>datetime</span>: <span class=kt>data.datetime</span> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div id=cusdis_thread data-host=https://cusdis.com data-app-id=287ed0fd-6a12-4302-a1ad-d2fd382e1199 data-page-id=f7155ff3c8e672aa204eb279b9e00ff9 data-page-url=https://blog.ververv.com/p/vercel-tutorial/ data-page-title="Vercel Tutorial"></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 量子跳跃者</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.24.2>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>