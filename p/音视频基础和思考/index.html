<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="总体层次 直播vs点播 云直播（LVB）、云点播（VOD） 传输协议 对比 内容延迟： RTP > RTMP和HDL > HLS DASH不清楚 协议 HDL(HTTP-FLV) RTMP HLS DASH 传输方式 htt"><title>音视频基础和思考</title>
<link rel=canonical href=https://blog.ververv.com/p/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80%E5%92%8C%E6%80%9D%E8%80%83/><link rel=stylesheet href=/scss/style.min.d8118f156935b64eca93aca758476adca858d2c47354971654d9bd2933a0e45f.css><meta property='og:title' content="音视频基础和思考"><meta property='og:description' content="总体层次 直播vs点播 云直播（LVB）、云点播（VOD） 传输协议 对比 内容延迟： RTP > RTMP和HDL > HLS DASH不清楚 协议 HDL(HTTP-FLV) RTMP HLS DASH 传输方式 htt"><meta property='og:url' content='https://blog.ververv.com/p/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80%E5%92%8C%E6%80%9D%E8%80%83/'><meta property='og:site_name' content='量子跳跃者'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2020-03-06T07:58:58+08:00'><meta property='article:modified_time' content='2020-03-06T07:58:58+08:00'><meta name=twitter:title content="音视频基础和思考"><meta name=twitter:description content="总体层次 直播vs点播 云直播（LVB）、云点播（VOD） 传输协议 对比 内容延迟： RTP > RTMP和HDL > HLS DASH不清楚 协议 HDL(HTTP-FLV) RTMP HLS DASH 传输方式 htt"><link rel="shortcut icon" href=/favicon.png><script defer src=https://analytics.ververv.com/pixel/tABAb34VvSTV05V2></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky compact"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><div class=site-meta><h1 class=site-name><a href=/>量子跳跃者</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/ target=_blank><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#总体层次>总体层次</a></li><li><a href=#直播vs点播>直播vs点播</a></li><li><a href=#传输协议>传输协议</a><ol><li><a href=#对比>对比</a><ol><li><a href=#hdl-vs-rtmp>HDL vs RTMP</a></li></ol></li><li><a href=#rtmp>RTMP</a></li><li><a href=#hdlhttp-flv>HDL（HTTP-FLV）</a></li><li><a href=#hls>HLS</a></li><li><a href=#dash>DASH</a></li><li><a href=#rtp>RTP</a></li><li><a href=#自适性串流>自适性串流</a><ol><li><a href=#实现>实现</a></li></ol></li><li><a href=#其它>其它</a></li></ol></li><li><a href=#基础知识>基础知识</a><ol><li><a href=#帧率>帧率</a></li><li><a href=#刷新率>刷新率</a></li><li><a href=#码率>码率</a></li><li><a href=#体积-带宽的控制>体积-带宽的控制</a></li><li><a href=#色彩空间>色彩空间</a></li><li><a href=#音频参数>音频参数</a><ol><li><a href=#采样率>采样率</a></li></ol></li></ol></li><li><a href=#像素>像素</a><ol><li><a href=#颜色空间>颜色空间</a></li></ol></li><li><a href=#编码>编码</a><ol><li><a href=#视频编码>视频编码</a></li><li><a href=#视频解码>视频解码</a></li><li><a href=#软解码>软解码</a></li><li><a href=#音频解码>音频解码</a><ol><li><a href=#g711>G.711</a></li></ol></li></ol></li><li><a href=#封装协议>封装协议</a></li><li><a href=#知识点>知识点</a><ol><li><a href=#streaming和progressive-download>Streaming和Progressive Download</a></li><li><a href=#gop>GOP</a></li></ol></li><li><a href=#工具>工具</a><ol><li><a href=#mediainfo>MediaInfo</a></li></ol></li><li><a href=#参考>参考</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/media/>Media</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80%E5%92%8C%E6%80%9D%E8%80%83/>音视频基础和思考</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 06, 2020</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 8 分钟</time></div></footer></div></header><section class=article-content><h2 id=总体层次>总体层次</h2><p><img src=https://img-blog.csdn.net/20160118002918690 loading=lazy alt=img></p><h2 id=直播vs点播>直播vs点播</h2><p>云直播（LVB）、云点播（VOD）</p><h2 id=传输协议>传输协议</h2><h3 id=对比>对比</h3><p>内容延迟：</p><p>RTP > RTMP和HDL > HLS</p><p>DASH不清楚</p><div class=table-wrapper><table><thead><tr><th>协议</th><th>HDL(HTTP-FLV)</th><th>RTMP</th><th>HLS</th><th>DASH</th></tr></thead><tbody><tr><td>传输方式</td><td>http流</td><td>tcp流</td><td>http</td><td>http</td></tr><tr><td>视频封装格式</td><td>flv</td><td>flv tag</td><td>Ts文件</td><td>Mp4 3gp webm 切片</td></tr><tr><td>延时</td><td>低</td><td>低</td><td>高</td><td>高</td></tr><tr><td>数据分段</td><td>连续流</td><td>连续流</td><td>切片文件</td><td>切片文件</td></tr><tr><td>Html5播放</td><td>可通过html5解封包播放(flv.js)</td><td>不支持</td><td>可通过(hls.js)</td><td>直接播放或者html5解封包播放</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>直播协议</th><th>优点</th><th>缺点</th><th>播放延迟</th></tr></thead><tbody><tr><td>FLV</td><td>成熟度高、高并发无压力</td><td>需集成 SDK 才能播放</td><td>2s - 3s</td></tr><tr><td>RTMP</td><td>优质线路下理论延迟最低</td><td>高并发情况下表现不佳</td><td>1s - 3s</td></tr><tr><td>HLS（m3u8）</td><td>手机浏览器支持度高</td><td>延迟非常高</td><td>10s - 30s</td></tr></tbody></table></div><h4 id=hdl-vs-rtmp>HDL vs RTMP</h4><p>这两个协议实际上传输数据是一样的，<strong>数据都是flv文件的tag</strong>。</p><p>http_flv是一个无限大的http流的文件，相比rtmp就只能直播，而rtmp还可以推流和更多的操作。</p><p>但是http有个好处，就是是以80http通信的，穿透性强，而且rtmp是非开放协议。</p><p>这两个协议是如今直播平台主选的直播方式，主要原因就是延时极低。</p><p><a class=link href=https://www.cnblogs.com/luconsole/p/6079534.html target=_blank rel=noopener>参考</a></p><h3 id=rtmp>RTMP</h3><p>是Adobe的专利协议，现在大部分国外的CDN已不支持。</p><p>相对其他协议而言，RTMP协议初次建立连接的时候握手过程过于复杂（底层基于TCP，这里说的是RTMP协议本身的交互），视不同的网络状况会带来给首开带来100ms以上的延迟。</p><p>基于RTMP的直播一般内容延迟：在2~5秒。</p><p>缺点：不是HTTP。</p><p>Real Time Messaging Protocol（实时消息传送协议）</p><ol><li>工作在TCP之上的明文协议，使用端口1935；</li><li>RTMPT封装在HTTP请求之中，可穿越防火墙；</li><li>RTMPS类似RTMPT，但使用的是HTTPS连接；</li></ol><p>协议分类</p><ul><li>RTMP：协议工作在TCP之上，是应用层协议，默认的端口是1935。</li><li>RTMPE：在RTMP的基础上增加了加密功能。</li><li>RTMPT：工作在HTTP之上，默认端口是80或443，可穿透防火墙。</li><li>RTMPS：类似RTMPT，增加了TLS/SSL的安全功能。</li><li>RTMFP：为RTMP协议的UDP版本。</li></ul><p><a class=link href=https://zhuanlan.zhihu.com/p/43034332 target=_blank rel=noopener>参考</a></p><h3 id=hdlhttp-flv>HDL（HTTP-FLV）</h3><p>不担心被Adobe的专利绑架。</p><p>内容延迟同样可以做到2~5秒，打开速度更快，因为HTTP本身没有复杂的状态交互。所以从延迟角度来看，HTTP-FLV要优于RTMP。</p><h3 id=hls>HLS</h3><p>有浏览器即可，所以流行度很高。</p><p>HLS是Apple推出的直播协议，是通过视频流切片成文件片段来直播的。客户端首先会请求一个m3u8文件，里面会有不同码率的流，或者直接是ts文件列表，通过给出的ts文件地址去依次播放。在直播的时候，客户端会不断请求m3u8文件，检查ts列表是否有新的ts切片。</p><p>这种方式直播的主要弊端就是延迟过大，最小延时为ts单个文件的时长。</p><h3 id=dash>DASH</h3><blockquote><p><strong>Dynamic Adaptive Streaming over HTTP</strong> (<strong>DASH</strong>), also known as <strong>MPEG-DASH</strong></p></blockquote><p>DASH实际工作原理和hls一样的，只不过不是mpegts文件，dash可以支持多种切片文件，比如mp4切片。当为mp4切片，客户端直接可用js控制利用html5直接播放。同样的，dash有延时。</p><h3 id=rtp>RTP</h3><p>实际应用场景下经常需要RTCP（RTP Control Protocol）配合来使用，可以简单理解为RTCP传输交互控制的信令，RTP传输实际的媒体数据。</p><p><strong>RTP在视频监控、视频会议、IP电话上有广泛的应用</strong>，因为视频会议、IP电话的一个重要的使用体验：内容实时性强。</p><p>RTP和它们有一个重要的区别就是默认是使用UDP协议来传输数据。</p><p>各大CDN厂商没有支持基于RTP直播的，所以目前国内主流还是RTMP或HTTP-FLV。</p><h3 id=自适性串流>自适性串流</h3><blockquote><p>自适性串流（英语：ABS, adaptive bitrate streaming），是一种在<a class=link href=https://zh.wikipedia.org/wiki/%e7%94%b5%e8%84%91%e7%bd%91%e7%bb%9c target=_blank rel=noopener>电脑网络</a>使用的一种技术<a class=link href=https://zh.wikipedia.org/wiki/%e6%b5%81%e5%aa%92%e4%bd%93 target=_blank rel=noopener>串流技术</a>。过去的流媒体技术多使用 <a class=link href=https://zh.wikipedia.org/wiki/RTP target=_blank rel=noopener>RTP</a>/<a class=link href=https://zh.wikipedia.org/wiki/RTSP target=_blank rel=noopener>RTSP</a>，但现在的技术则大多基于 HTTP，并为更高效在大型分布式HTTP网络（例如互联网）分发而设计。</p></blockquote><ul><li>流媒体客户端首先获取所有码率的切片索引信息。</li><li>一开始，客户端先请求最低码率的串流。如果客户端判断下载速度比当前码率的切片串流快，它就去请求下一个更高码率的串流。</li><li>随着播放的进行，如果客户端发现下载速度比当前码率的切片串流慢，转而请求下一个较低码率的串流。</li></ul><p><a class=link href=https://zh.wikipedia.org/wiki/%E8%87%AA%E9%81%A9%E6%80%A7%E4%B8%B2%E6%B5%81 target=_blank rel=noopener>Wiki</a></p><p>切片大小和具体实现密切相关，不过一般都在2～10秒之间。每个切片由一个完整的<a class=link href=https://zh.wikipedia.org/wiki/GOP target=_blank rel=noopener>GOP</a>序列组成。</p><h4 id=实现>实现</h4><ul><li>MPEG-DASH</li><li>Adobe HTTP Dynamic Streaming (HDS)</li><li>Apple HTTP Live Streaming (HLS)</li><li>Microsoft Smooth Streaming (MSS)</li></ul><p>Apple 和微软基于 HTTP。</p><h3 id=其它>其它</h3><p>各种传输协议简介</p><p><a class=link href=https://zhuanlan.zhihu.com/p/69184805 target=_blank rel=noopener>https://zhuanlan.zhihu.com/p/69184805</a></p><h2 id=基础知识>基础知识</h2><h3 id=帧率>帧率</h3><p>Frame Rate</p><p>定义：</p><p>单位：fps（frame per second）或Hz</p><p>指标：30fps是可以接受的。</p><h3 id=刷新率>刷新率</h3><p><strong>屏幕</strong>每秒刷新画面的次数。</p><p>单位：Hz</p><p>指标：80Hz以上就可以消除图像闪烁和抖动感，眼睛也不容易疲劳。</p><h3 id=码率>码率</h3><p>也称比特率（bit rate）。</p><p>定义：单位时间播放的媒体的比特数量。</p><p>单位：b/s</p><p>公式：码率=文件大小(b)/时长(s)</p><p>用途：衡量消耗的带宽。</p><p><a class=link href="https://support.google.com/youtube/answer/1722171?hl=zh-Hans" target=_blank rel=noopener>参考Youtube</a></p><h3 id=体积-带宽的控制>体积-带宽的控制</h3><p>在使用 OBS 录屏时，我们希望视频效果既清晰体积又小，所以这里就需要合理的设置分辨率、帧率、码率。</p><p><strong>码率</strong> 则是单位时间数据的位数，一般使用 Kbps 做单位。</p><p>我的录屏使用的是 1920x1080 分辨率，帧率设置为 30，那么码率可以设置为：4860</p><p><img src=https://zhangzw.com/posts/20200204/201604211504013279.jpg loading=lazy alt=201604211504013279></p><p>各大平台默认1500</p><p><a class=link href=https://www.bilibili.com/read/cv395368/ target=_blank rel=noopener>参考1</a></p><p><a class=link href=https://www.zhihu.com/question/49460691 target=_blank rel=noopener>参考2</a></p><p><img src=https://pic4.zhimg.com/80/v2-6242f573451cbfed293ff6ba9543de9f_1440w.jpg loading=lazy alt=img></p><p>手机</p><p><img src=https://pic3.zhimg.com/80/v2-24d825761d500ae9a0bf42e4c7a32c88_1440w.jpg loading=lazy alt=img></p><p>Youtube</p><div class=table-wrapper><table><thead><tr><th style=text-align:left>类型</th><th style=text-align:left>视频比特率（标准帧速率） （24、25、30）</th><th style=text-align:left>视频比特率（高帧速率） （48、50、60）</th></tr></thead><tbody><tr><td style=text-align:left>2160p (4k)</td><td style=text-align:left>35-45 Mbps</td><td style=text-align:left>53-68 Mbps</td></tr><tr><td style=text-align:left>1440p (2k)</td><td style=text-align:left>16 Mbps</td><td style=text-align:left>24 Mbps</td></tr><tr><td style=text-align:left>1080p</td><td style=text-align:left>35-45 Mbps??</td><td style=text-align:left>12 Mbps</td></tr><tr><td style=text-align:left>720p</td><td style=text-align:left>5 Mbps</td><td style=text-align:left>7.5 Mbps</td></tr><tr><td style=text-align:left>480p</td><td style=text-align:left>2.5 Mbps</td><td style=text-align:left>4 Mbps</td></tr><tr><td style=text-align:left>360p</td><td style=text-align:left>1 Mbps</td><td style=text-align:left>1.5 Mbps</td></tr></tbody></table></div><p><a class=link href="https://support.google.com/youtube/answer/1722171?hl=zh-Hans" target=_blank rel=noopener>参考3</a></p><h3 id=色彩空间>色彩空间</h3><ul><li>SDR（标准动态范围 Standard Dynamic Range）：BT.709</li><li>HDR（高动态范围 High Dynamic Range）：视频使用BT.2020</li></ul><h3 id=音频参数>音频参数</h3><h4 id=采样率>采样率</h4><ul><li>8kHz：电话</li><li>22.05kHz：无线广播</li><li>44.1kHz：CD和VCD</li><li>48kHz：DVD、数字电视</li><li>96kHz：蓝光</li></ul><p>量化精度：CD级16bit，DVD24bit。</p><h2 id=像素>像素</h2><h3 id=颜色空间>颜色空间</h3><ul><li>RGB</li><li>HSV</li><li>YUV</li></ul><h2 id=编码>编码</h2><h3 id=视频编码>视频编码</h3><p>两个系列：</p><ul><li>H.26X：H263、H264、HEVC（H265）</li><li>MPEG：MPEG-2 、MPEG-4 等</li></ul><h3 id=视频解码>视频解码</h3><p>ffmpeg 使用的是软解码，也即是纯 CPU 解码；</p><p>而使用平台的 MediaCodec 播放的是硬解码，也就是支持 GPU 协助。</p><h3 id=软解码>软解码</h3><p>Andorid、iOS播放器都使用软解码方案，经过我们和大量客户的测试以及总结，虽然牺牲了功耗，但是在部分细节方面表现会较优，且可控性强，兼容性也强，出错情况少，推荐使用。</p><h3 id=音频解码>音频解码</h3><h4 id=g711>G.711</h4><p>2008年ITU-T定制出来的一套语音压缩标准。</p><p>两个压缩算法（编码方式）：</p><ul><li>A-law：欧洲和世界其他地区，特别设计用来方便计算机处理的</li><li>μ-law：北美和日本</li></ul><p>用途：主要用于电话</p><ul><li>采样率：8kHz</li><li>信息量-带宽-体积：64kbps／channel = 8bit*8kHz</li><li>理论延迟：0.125msec</li><li>品质：MOS值4.10</li></ul><p><a class=link href=https://zh.wikipedia.org/wiki/G.711 target=_blank rel=noopener>Wiki</a></p><h2 id=封装协议>封装协议</h2><p>视频</p><p>MP4 、AVI 、RMVB 、MKV、TS、FLV</p><p>音频</p><p>AAC 也是有损压缩，但是又有分有 LC-AAC、HE-AAC等。</p><h2 id=知识点>知识点</h2><h3 id=streaming和progressive-download>Streaming和Progressive Download</h3><p>总体</p><ul><li><p>Streaming是实时流</p></li><li><p>Progressive Download是分片后的分段式下载缓冲</p></li><li><p>Streaming不需要缓存实体文件，并且可以从任意时间点开始播放。</p></li><li><p>Progressive Download需要将预下载文件存放到本地存储，并且默认情况下，播放器不会自动删除缓存文件。但Progressive Download无法精确到帧开始播放，只能从流媒体文件的切片点开始。</p></li></ul><p>网络</p><p>Progressive Download由于基于HTTP协议，所以出现丢包会重新传输数据。</p><p>Streaming对网络的利用率更高，而Progressive Download由于需要校验以及其他一些协议上的原因，网络利用率较低。</p><p>一个注重高时效性，高网络利用率，另一个注重数据可靠性和协议通用性/兼容性。</p><p>Streaming的协议</p><ul><li>RTP/RTSP</li><li>Sliverlight</li><li>MMS</li></ul><p>Progressive Download的协议</p><ul><li>HLS</li><li>TS/FLV Over HTTP</li></ul><h3 id=gop>GOP</h3><p><strong>GOP（Group Of Picture）就是两个 I 帧之间的距离，一般 GOP 设置得越大，画面的效果就会越好，到那时需要解码的时间就会越长。</strong> 所以如果码率固定而 GOP 值越大，P/B帧 数量会越多，画面质量就会越高</p><p>服务端提供转</p><p>格式与转码率</p><p>因为在服务端判断视频格式并转码可以规范编码统一，这能够减少客户端端因为编解码失败无法播放的问题。</p><p>提供同一视频不同码率的链接，可以在不同手机型号和系统上能够拥有更好的播放体验，减少前面说过的因为码率太高出现音视频不同步或者卡顿的问题。</p><p>类似功能在阿里云和腾讯云都支持。</p><p>封装协议、视频编码、音频编码格式</p><p>3、在网络播放中存在很多场景，比如播放过程中网络环境出现变化，是从 4G 转化为 Wifi 还是从 Wifi 转到了 4G 的场景 ，这里面涉及到两个点：<strong>第一是网络环境发生改变，那么原本的拉流通道其实已经断开，这时候需要重新启动一个新的连接来替换旧的播放内核，才能实现继续播放；第二就是 Wifi 到 4G 之间的环境发生改变时，需要给用户提示并确定是否执行后续操作。</strong></p><p>muxer</p><p>muxer是指合并文件，即将视频文件、音频文件和字幕文件合并为某一个视频格式。比如把rmvb格式的视频，mp3格式的音频文件以及srt格式的字幕文件，合并成为一个新的mp4或者mkv格式的文件。</p><img src=https://pic4.zhimg.com/80/v2-ace3965194827186f294ae05b975ed3b_1440w.jpg alt=img><p>demuxer</p><p>demuxer是muxer的逆过程，就是把合成的文件中提取出不同的格式文件。</p><p><img src=https://pic2.zhimg.com/80/v2-55ce78878025203808eef4911b88a131_1440w.jpg loading=lazy alt=img></p><p><strong>播放器原理</strong></p><p>视频播放原理：（mp4、flv）-> 解封装 -> （mp3/aac、h264/h265）-> 解码 -> （pcm、yuv）-> 音视频同步 -> 渲染播放</p><p>音视频同步：</p><ul><li>选择参考时钟源：音频时间戳、视频时间戳和外部时间三者选择一个作为参考时钟源（一般选择音频，因为人对音频更敏感，ijk 默认也是音频）</li><li>通过等待或丢帧将视频流与参考时钟源对齐，实现同步</li></ul><p><strong>IjkPlayer 原理</strong></p><p>集成了 MediaPlayer、ExoPlayer 和 IjkPlayer 三种实现，其中 IjkPlayer 基于 FFmpeg 的 ffplay</p><p>音频输出方式：AudioTrack、OpenSL ES；视频输出方式：NativeWindow、OpenGL ES</p><h2 id=工具>工具</h2><h3 id=mediainfo>MediaInfo</h3><p><a class=link href=https://mediaarea.net/en/MediaInfo/Download target=_blank rel=noopener>Windows版本</a>比较强大</p><p><img src=https://i0.hdslb.com/bfs/article/d7c953442dd853c6770429bd57bb93098cb7722a.png@1220w_896h.jpg loading=lazy alt=img></p><h2 id=参考>参考</h2><p><a class=link href=https://juejin.im/post/5e12fe306fb9a0481467d399 target=_blank rel=noopener>移动开发者的必知音视频基础知识</a></p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div id=cusdis_thread data-host=https://cusdis.com data-app-id=287ed0fd-6a12-4302-a1ad-d2fd382e1199 data-page-id=fcf9f1ebe5cf123c6260194af1b27f1b data-page-url=https://blog.ververv.com/p/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80%E5%92%8C%E6%80%9D%E8%80%83/ data-page-title=音视频基础和思考></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 量子跳跃者</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.24.2>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>